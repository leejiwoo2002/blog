import Layout from '@components/layout/layout';
import Image from 'next/image';

export const meta = {
  title: 'New Suspense SSR Architecture in React 18',
  pid: 2,
  description:
    '새롭게 등장할 React 18 버전의 Serverside 렌더링 동작 방식과, Suspense의 구조에 대해 알아보자.',
  birthTime: '2022-03-17',
};

<Layout meta={meta} title={meta.title} >

<br />
<Image src="/img/thumbnail/2.png" layout={'responsive'} width={100} height={52} />

본 아티클은 React 18 Github의 [Discussion - New Suspense SSR Architecture in React 18](https://github.com/reactwg/react-18/discussions/37) 게시글을 번역한 내용을 담아두었습니다.

# 개요
React 18은 서버 사이드 렌더링(SSR) 성능에 대한 아키텍쳐 개선 내용을 포함합니다. 이 사항들은 상당한 개선들을 포함하며, 수년간에 걸친 작업이었습니다. 개선점들의 대부분은 우리가 알지 못하는 뒷 단에서 일어나지만, 프레임워크를 사용하지 않고 순수히 React 만을 사용할 경우 알아야 할 몇 가지 매커니즘들이 있습니다.

  새롭게 등장하는 API인 **renderToPipeableStream**에 대해서는 [서버에서 React 18로 업그레이드 하기](https://github.com/reactwg/react-18/discussions/22)문서에서 더 자세한 내용을 볼 수 있습니다. 현재 최종적인 내용이 아니며, 해결해야 할 사항들이 있는 만큼 릴리즈 전까지 더 자세한 내용을 작성할 게획입니다.

  기존에 존재하던 API인 **Suspense** 도 있습니다

  본 아티클에서는 새로운 아키텍쳐와 그 설계, 그리고 이 개선점들이 해결하는 문제들에 대해 알아보고자 합니다.
  <br />

  # 간단 요약
  서버사이드 렌더링(이하 SSR)을 사용하면 서버측에서 리액트 컴포넌트로 구성된 HTML을 생성할 수 있으며, 해당 HTML을 사용자에게 전송할 수 있습니다. SSR은 사용자가 JavaScript 번들을 로드하고 실행하기 전에 페이지의 컨텐츠를 볼 수 있도록 해줍니다.

  React에서 SSR은 다음과 같은 단계를 거치게 됩니다.
  - 서버단에서, React가 동작하여 앱을 위한 데이터를 fetch합니다.
  - 서버단에서, 앱을 HTML로 렌더한 뒤, 사용자에게 해당 파일을 전송합니다.
  - 클라이언트단에서, 앱을 사용하기 위한 JavaScript를 로드합니다.
  - 클라이언트단에서, 서버단에서 생성된 HTML에 JavaScript 로직을 연결합니다. (이것이 "hydration" 입니다.)

핵심 포인트는, 위 단계에서 다음 단계가 시작되기 전에 이전 단계가 완료되어야 한다는 것 입니다. 즉, 일부 단게가 다른 단계보다 현저히 느릴 경우 단계 전체에 영향을 미치게 되며 결국 앱이 효율적으로 동작하지 못하게 됩니다.

  React 18의 **Suspense**를 사용하면 앱의 구성 요소들을 위의 각 단계에서 Blocking 하지 않도록 하는 작은 단위의 독립적인 형태들로 분할할 수 있습니다. 결과적으로 앱의 사용자들은 콘텐츠를 더 빨리 볼 수 있게 되며 앱과 더 빨리 상호작용할 수 있게 됩니다. 또 앱의 느린 부분이 빠른 부분의 발목을 잡지 않도록 동작합니다. 이러한 개선점들은 자동으로 적용되며 별도의 코드를 작성할 필요가 없습니다.

  이것은 또한 **React.lazy**가 SSR에서 잘 동작한다는 것을 의미합니다. 여기 [데모](https://codesandbox.io/s/kind-sammet-j56ro?file=/src/App.js)를 확인해주세요.
  <br />

  # SSR이란 무엇인가?
  우리는 사용자에게 페이지를 제공할때 가능한한 빠르게 상호작용 가능한 상태를 만들고 싶어 합니다.

<Image src={"/img/post/2/1.png"}  width={500} height={375}/>


위 그림에서는 페이지의 상호작용 가능한 부분을 표시하기 위해 해당 부분을 초록색으로 칠해두었습니다.

<br />
<br />
<br />

# 작성중


# 자료 출처

- [Discussion - New Suspense SSR Architecture in React 18](https://github.com/reactwg/react-18/discussions/37)

<br/>
</Layout>
